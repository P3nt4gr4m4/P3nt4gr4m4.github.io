<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Descargar Video de YouTube</title>
    <script>
        function generarURL() {
            const formato = document.getElementById("formato").value;
            const urlVideo = document.getElementById("urlVideo").value;
            if (urlVideo.trim() === "") {
                alert("Por favor, introduce una URL válida de YouTube.");
                return;
            }
            
            // Genera la URL de descarga
            const downloadURL = `https://loader.to/ajax/download.php?format=${formato}&url=${encodeURIComponent(urlVideo)}`;
            console.log("URL generada para la solicitud:", downloadURL);  // Muestra la URL generada

            // Realiza una solicitud AJAX para obtener el ID de descarga
            fetch(downloadURL)
                .then(response => {
                    console.log("Respuesta recibida:", response);  // Muestra la respuesta completa
                    return response.json();
                })
                .then(data => {
                    console.log("Datos recibidos del servidor:", data);  // Muestra los datos recibidos
                    if (data.success && data.id) {
                        const progressID = data.id; // Extraemos el ID del resultado
                        const progressURL = `https://p.oceansaver.in/ajax/progress.php?id=${progressID}`;
                        document.getElementById("linkDescarga").href = progressURL;
                        document.getElementById("linkDescarga").style.display = "block";
                        document.getElementById("linkDescarga").innerText = `Ver progreso de descarga (ID: ${progressID})`;
                    } else {
                        alert("Error al generar el ID de descarga. Verifica la respuesta.");
                    }
                })
                .catch(error => {
                    console.error("Error al realizar la solicitud:", error);
                    alert("Ocurrió un error al generar la URL de descarga.");
                });
        }
    </script>
</head>
<body>
    <h1>Descargar Video de YouTube</h1>

    <label for="formato">Selecciona el formato:</label>
    <select id="formato">
        <option value="360">360</option>
        <option value="480">480</option>
        <option value="720">720</option>
        <option value="1080">1080</option>
        <option value="1440">1440</option>
    </select>

    <br><br>

    <label for="urlVideo">Introduce la URL del video de YouTube:</label>
    <input type="text" id="urlVideo" placeholder="https://www.youtube.com/watch?v=xxxxxx" size="50">

    <br><br>

    <button onclick="generarURL()">Generar URL de descarga</button>

    <br><br>

    <a id="linkDescarga" href="#" target="_blank" style="display: none;">Ver progreso de descarga</a>
</body>
</html>
